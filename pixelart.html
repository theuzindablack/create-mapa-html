<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Lunar Pixel - Color Picker Update</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #121212; color: white; font-family: sans-serif; display: flex; height: 100vh; overflow: hidden; }
        
        #sidebar { 
            width: 260px; min-width: 260px; background: #1a1a1a; 
            border-right: 2px solid #000; display: flex; flex-direction: column; 
            padding: 15px; overflow-y: auto; height: 100vh;
        }

        #main-content { flex: 1; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }

        #canvas-area { 
            flex: 1; display: flex; align-items: center; justify-content: center; 
            background-image: linear-gradient(45deg, #222 25%, transparent 25%), linear-gradient(-45deg, #222 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #222 75%), linear-gradient(-45deg, transparent 75%, #222 75%);
            background-size: 20px 20px; background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
        }

        #grid { display: grid; grid-template-columns: repeat(16, 25px); border: 2px solid #555; }
        .p { width: 25px; height: 25px; border: 0.1px solid rgba(255,255,255,0.05); }

        #timeline-container { 
            height: 140px; background: #222; border-top: 3px solid #000; 
            width: 100%; overflow-x: auto; overflow-y: hidden; white-space: nowrap; 
            padding: 15px; display: flex; align-items: flex-start; gap: 12px;
        }

        .frame-thumb { 
            display: inline-flex; min-width: 90px; height: 90px; 
            background: #333; border: 2px solid #555; cursor: pointer; 
            position: relative; align-items: center; justify-content: center; flex-shrink: 0;
        }
        .frame-active { border-color: #f1c40f; background: #444; }

        .btn { padding: 10px; margin-bottom: 8px; cursor: pointer; border: none; font-weight: bold; border-radius: 4px; transition: 0.2s; }
        .btn-hub { background: #e74c3c; color: white; }
        .btn-tool { background: #34495e; color: white; }
        .active-tool { background: #3498db !important; outline: 2px solid white; }
        .delete-frame-btn { position: absolute; top: -5px; right: -5px; background: #e74c3c; border-radius: 50%; width: 20px; height: 20px; border: none; color: white; }
    </style>
</head>
<body>

<div id="sidebar">
    <button class="btn btn-hub" onclick="location.href='index.html'">‚¨Ö HUB</button>
    
    <label style="font-size: 11px; color: #888;">COR ATUAL:</label>
    <input type="color" id="colorPicker" value="#ff0000" style="width: 100%; height: 50px; margin-bottom: 10px; cursor:pointer;">
    
    <button id="tool-paint" class="btn btn-tool active-tool" onclick="setTool('paint')">üñåÔ∏è PINCEL</button>
    <button id="tool-pick" class="btn btn-tool" onclick="setTool('pick')" style="background: #9b59b6;">üß™ CONTA-GOTAS</button>
    <button id="tool-erase" class="btn btn-tool" onclick="setTool('erase')" style="background: #f39c12;">üßΩ BORRACHA</button>
    
    <hr style="border: 1px solid #333; margin: 10px 0;">
    
    <button class="btn" style="background:#27ae60; color:white;" onclick="addFrame()">‚ûï NOVO FRAME</button>
    <button class="btn" id="btnPlay" style="background:#f1c40f;" onclick="playAnim()">‚ñ∂ PLAY</button>
    <button class="btn" style="background:#2980b9; color:white;" onclick="copyHTML()">üìã COPIAR HTML</button>
</div>

<div id="main-content">
    <div id="canvas-area">
        <div id="grid"></div>
    </div>
    <div id="timeline-container"></div>
</div>

<script>
    const grid = document.getElementById('grid'), colorPicker = document.getElementById('colorPicker'), timeline = document.getElementById('timeline-container');
    let frames = [new Array(256).fill('transparent')], currentFrame = 0, tool = 'paint', isPlaying = false, timer;

    function initGrid() {
        grid.innerHTML = '';
        for(let i=0; i<256; i++) {
            const div = document.createElement('div');
            div.className = 'p';
            div.style.backgroundColor = frames[currentFrame][i];
            div.onmousedown = () => useTool(div, i);
            div.onmouseenter = (e) => { if(e.buttons === 1 && tool !== 'pick') useTool(div, i); };
            grid.appendChild(div);
        }
        renderTimeline();
    }

    function setTool(t) {
        tool = t;
        document.querySelectorAll('.btn-tool').forEach(b => b.classList.remove('active-tool'));
        document.getElementById('tool-' + t).classList.add('active-tool');
    }

    function useTool(el, i) {
        if (tool === 'pick') {
            const colorPicked = frames[currentFrame][i];
            if (colorPicked !== 'transparent') {
                colorPicker.value = rgbToHex(el.style.backgroundColor);
                setTool('paint'); // Volta para o pincel ap√≥s pegar a cor
            }
        } else {
            const color = (tool === 'erase') ? 'transparent' : colorPicker.value;
            el.style.backgroundColor = color;
            frames[currentFrame][i] = color;
        }
    }

    // Fun√ß√£o auxiliar para converter RGB do navegador para HEX do input
    function rgbToHex(rgb) {
        if (!rgb || rgb === "transparent") return "#ffffff";
        const res = rgb.match(/\d+/g);
        return "#" + ((1 << 24) + (parseInt(res[0]) << 16) + (parseInt(res[1]) << 8) + parseInt(res[2])).toString(16).slice(1);
    }

    function addFrame() {
        frames.push([...frames[currentFrame]]);
        currentFrame = frames.length - 1;
        initGrid();
    }

    function deleteFrame(index, e) {
        e.stopPropagation();
        if(frames.length > 1) {
            frames.splice(index, 1);
            currentFrame = Math.max(0, index - 1);
            initGrid();
        }
    }

    function renderTimeline() {
        timeline.innerHTML = '';
        frames.forEach((f, i) => {
            const thumb = document.createElement('div');
            thumb.className = `frame-thumb ${i === currentFrame ? 'frame-active' : ''}`;
            thumb.innerHTML = `F${i+1} <button class="delete-frame-btn" onclick="deleteFrame(${i}, event)">√ó</button>`;
            thumb.onclick = () => { currentFrame = i; initGrid(); };
            timeline.appendChild(thumb);
        });
    }

    function playAnim() {
        if(isPlaying) { isPlaying = false; clearInterval(timer); document.getElementById('btnPlay').innerText = "‚ñ∂ PLAY"; return; }
        isPlaying = true; document.getElementById('btnPlay').innerText = "‚èπ PARAR";
        let step = 0;
        timer = setInterval(() => {
            currentFrame = step; initGrid();
            step = (step + 1) % frames.length;
        }, 150);
    }

    function copyHTML() {
        const html = `<!DOCTYPE html><html><head><style>body{background:#111;margin:0;display:flex;justify-content:center;align-items:center;height:100vh;}#c{display:grid;grid-template-columns:repeat(16,20px);} .px{width:20px;height:20px;}</style></head><body><div id="c"></div><script>const f=${JSON.stringify(frames)};const el=document.getElementById('c');let cur=0;setInterval(()=>{el.innerHTML=f[cur].map(p=>\`<div class="px" style="background:\${p}"></div>\`).join('');cur=(cur+1)%f.length;},150);<\/script></body></html>`;
        navigator.clipboard.writeText(html);
        alert("Copiado!");
    }

    initGrid();
</script>
</body>
</html>
