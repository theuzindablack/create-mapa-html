<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Lunar Pixel Animator - Scroll Fix</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #121212; color: white; font-family: sans-serif; display: flex; height: 100vh; overflow: hidden; }
        
        /* Sidebar Fixa */
        #sidebar { 
            width: 260px; min-width: 260px; background: #1a1a1a; 
            border-right: 2px solid #000; display: flex; flex-direction: column; 
            padding: 15px; overflow-y: auto; height: 100vh;
        }

        /* √Årea Principal */
        #main-content { flex: 1; display: flex; flex-direction: column; height: 100vh; overflow: hidden; }

        #canvas-area { 
            flex: 1; display: flex; align-items: center; justify-content: center; 
            background-image: linear-gradient(45deg, #222 25%, transparent 25%), linear-gradient(-45deg, #222 25%, transparent 25%), linear-gradient(45deg, transparent 75%, #222 75%), linear-gradient(-45deg, transparent 75%, #222 75%);
            background-size: 20px 20px; background-position: 0 0, 0 10px, 10px -10px, -10px 0px;
            overflow: auto;
        }

        #grid { display: grid; grid-template-columns: repeat(16, 25px); border: 2px solid #555; background: transparent; }
        .p { width: 25px; height: 25px; border: 0.1px solid rgba(255,255,255,0.05); }

        /* TIMELINE COM ROLAGEM (A SOLU√á√ÉO) */
        #timeline-container { 
            height: 140px; background: #222; border-top: 3px solid #000; 
            width: 100%; overflow-x: auto; /* Ativa a rolagem horizontal */
            overflow-y: hidden; white-space: nowrap; padding: 15px;
            display: flex; align-items: flex-start; gap: 12px;
        }
        
        /* Estiliza√ß√£o da Barra de Rolagem */
        #timeline-container::-webkit-scrollbar { height: 10px; }
        #timeline-container::-webkit-scrollbar-track { background: #111; }
        #timeline-container::-webkit-scrollbar-thumb { background: #444; border-radius: 5px; }
        #timeline-container::-webkit-scrollbar-thumb:hover { background: #f1c40f; }

        .frame-thumb { 
            display: inline-flex; min-width: 90px; height: 90px; 
            background: #333; border: 2px solid #555; cursor: pointer; 
            position: relative; align-items: center; justify-content: center; 
            font-size: 11px; flex-shrink: 0; /* Impede o frame de espremer */
        }
        .frame-active { border-color: #f1c40f; background: #444; box-shadow: 0 0 10px rgba(241, 196, 15, 0.3); }
        
        .delete-frame-btn { position: absolute; top: -8px; right: -8px; background: #e74c3c; border-radius: 50%; width: 22px; height: 22px; border: 2px solid #222; color: white; cursor: pointer; font-size: 12px; font-weight: bold; }

        .btn { padding: 10px; margin-bottom: 8px; cursor: pointer; border: none; font-weight: bold; border-radius: 4px; transition: 0.2s; font-size: 13px; }
        .btn-hub { background: #e74c3c; color: white; }
        .btn-add { background: #27ae60; color: white; width: 100%; }
        .btn-tool { background: #34495e; color: white; }
        .active-tool { background: #3498db !important; outline: 2px solid white; }
        
        #code-preview { flex: 1; background: #000; color: #0f0; font-family: monospace; font-size: 10px; padding: 10px; margin-top: 10px; overflow: auto; border: 1px solid #333; }
    </style>
</head>
<body>

<div id="sidebar">
    <button class="btn btn-hub" onclick="location.href='index.html'">‚¨Ö HUB</button>
    <input type="color" id="colorPicker" value="#ff0000" style="width: 100%; height: 45px; margin-bottom: 10px; border:none; background:none; cursor:pointer;">
    
    <button id="tool-paint" class="btn btn-tool active-tool" onclick="setTool('paint')">üñåÔ∏è PINCEL</button>
    <button id="tool-erase" class="btn btn-tool" onclick="setTool('erase')">üßΩ BORRACHA</button>
    <button class="btn" style="background:#7f8c8d; color:white;" onclick="clearFrame()">üóëÔ∏è LIMPAR FRAME</button>
    
    <hr style="border: 1px solid #333; margin: 10px 0;">
    
    <button class="btn btn-add" onclick="addFrame()">‚ûï NOVO FRAME</button>
    <button class="btn" id="btnPlay" style="background:#f1c40f; color:#000;" onclick="playAnim()">‚ñ∂ PLAY</button>
    <button class="btn" style="background:#2980b9; color:white;" onclick="copyHTML()">üìã COPIAR HTML</button>
    
    <div id="code-preview"></div>
</div>

<div id="main-content">
    <div id="canvas-area">
        <div id="grid"></div>
    </div>
    
    <div id="timeline-container"></div>
</div>

<script>
    const grid = document.getElementById('grid');
    const colorPicker = document.getElementById('colorPicker');
    const timeline = document.getElementById('timeline-container');
    const codePreview = document.getElementById('code-preview');
    
    let frames = [new Array(256).fill('transparent')];
    let currentFrame = 0;
    let tool = 'paint';
    let isPlaying = false;
    let timer;

    function initGrid() {
        grid.innerHTML = '';
        for(let i=0; i<256; i++) {
            const div = document.createElement('div');
            div.className = 'p';
            div.style.backgroundColor = frames[currentFrame][i];
            div.onmousedown = () => useTool(div, i);
            div.onmouseenter = (e) => { if(e.buttons === 1) useTool(div, i); };
            grid.appendChild(div);
        }
        renderTimeline();
        updateSync();
    }

    function setTool(t) {
        tool = t;
        document.getElementById('tool-paint').classList.toggle('active-tool', t === 'paint');
        document.getElementById('tool-erase').classList.toggle('active-tool', t === 'erase');
    }

    function useTool(el, i) {
        const color = (tool === 'erase') ? 'transparent' : colorPicker.value;
        el.style.backgroundColor = color;
        frames[currentFrame][i] = color;
        updateSync();
    }

    function addFrame() {
        const newFrame = [...frames[currentFrame]];
        frames.push(newFrame);
        currentFrame = frames.length - 1;
        initGrid();
        // Rola automaticamente para o novo frame
        setTimeout(() => timeline.scrollLeft = timeline.scrollWidth, 50);
    }

    function deleteFrame(index, event) {
        event.stopPropagation();
        if(frames.length > 1) {
            frames.splice(index, 1);
            currentFrame = Math.max(0, index - 1);
            initGrid();
        }
    }

    function clearFrame() {
        if(confirm("Limpar este frame?")) {
            frames[currentFrame].fill('transparent');
            initGrid();
        }
    }

    function renderTimeline() {
        timeline.innerHTML = '';
        frames.forEach((f, i) => {
            const thumb = document.createElement('div');
            thumb.className = `frame-thumb ${i === currentFrame ? 'frame-active' : ''}`;
            thumb.innerHTML = `FRAME ${i+1} <button class="delete-frame-btn" onclick="deleteFrame(${i}, event)">√ó</button>`;
            thumb.onclick = () => { currentFrame = i; initGrid(); };
            timeline.appendChild(thumb);
        });
    }

    function updateSync() {
        codePreview.innerText = `// FRAMES: ${frames.length}\n// CURSOR: ${currentFrame}\n` + JSON.stringify(frames);
    }

    function playAnim() {
        if(isPlaying) { isPlaying = false; clearInterval(timer); document.getElementById('btnPlay').innerText = "‚ñ∂ PLAY"; return; }
        isPlaying = true;
        document.getElementById('btnPlay').innerText = "‚èπ PARAR";
        let step = 0;
        timer = setInterval(() => {
            currentFrame = step;
            initGrid();
            step = (step + 1) % frames.length;
        }, 150);
    }

    function copyHTML() {
        const html = `<!DOCTYPE html><html><head><style>body{background:#111;margin:0;display:flex;justify-content:center;align-items:center;height:100vh;}#c{display:grid;grid-template-columns:repeat(16,20px);border:4px solid #333;}.px{width:20px;height:20px;}</style></head><body><div id="c"></div><script>const f=${JSON.stringify(frames)};const el=document.getElementById('c');let cur=0;setInterval(()=>{el.innerHTML=f[cur].map(p=>\`<div class="px" style="background:\${p}"></div>\`).join('');cur=(cur+1)%f.length;},150);<\/script></body></html>`;
        navigator.clipboard.writeText(html);
        alert("C√≥digo copiado!");
    }

    initGrid();
</script>
</body>
</html>
